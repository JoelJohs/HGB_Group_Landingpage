---
import projectsData from "../data/projects.json";

import totalplayImage from "../assets/projects/totalplay.jpeg";
import amazonImage from "../assets/projects/amazon.jpg";
import ikeaImage from "../assets/projects/ikea.jpeg";
import prodemexImage from "../assets/projects/prodemex.jpeg";
import johnsonImage from "../assets/projects/johnsonjohnson.jpg";
import hospitalBanderasImage from "../assets/projects/hospitalbanderas.jpeg";
import hospitalAguascalientesImage from "../assets/projects/hospitalaguascalientes.jpeg";
import chedrauiImage from "../assets/projects/chedraui.jpg";
import equinixImage from "../assets/projects/equinix.jpg";
import maxitunelImage from "../assets/projects/maxitunelacapulco.jpeg";

// Crea una asociación entre el título del proyecto y la imagen importada.
const images = {
  "Total Play": totalplayImage,
  Amazon: amazonImage,
  IKEA: ikeaImage,
  PRODEMEX: prodemexImage,
  "Johnson & Johnson": johnsonImage,
  "Hospital General, Bahía de Banderas": hospitalBanderasImage,
  "Hospital General de Zona IMSS Aguascalientes": hospitalAguascalientesImage,
  CHEDRAUI: chedrauiImage,
  Equinix: equinixImage,
  "Maxitunel Acapulco": maxitunelImage,
};

// Recorre el JSON y reemplaza la propiedad image con la imagen importada.
const projects = projectsData.map((project) => ({
  ...project,
  image: images[project.title as keyof typeof images],
}));
---

<section
  id="proyectos"
  class="py-12 px-4 bg-[var(--color-background-50)] relative overflow-hidden"
>
  <div class="container mx-auto">
    <h2
      class="font-bold text-[var(--color-text-900)] text-center mb-8"
      style="font-size: clamp(2rem, 5vw, 3rem);"
    >
      Proyectos Destacados
    </h2>
    <div class="relative">
      <!-- Slides wrapper con padding-bottom -->
      <div
        id="projects-carousel"
        class="flex transition-transform duration-500 pb-8"
      >
        {
          projects.map((project) => (
            <div class="slide flex-none w-full p-4">
              <div class="bg-white shadow rounded overflow-hidden h-full md:h-80">
                <div class="flex flex-col md:flex-row h-full">
                  <div class="w-full md:w-1/2 md:max-w-md mx-auto overflow-hidden h-full">
                    <img
                      src={project.image.src}
                      alt={project.alt}
                      class="w-full h-full object-cover"
                    />
                  </div>
                  <div class="w-full md:w-1/2 p-4 flex flex-col justify-center">
                    <h3
                      class="font-semibold text-[var(--color-primary-500)] mb-2"
                      style="font-size: clamp(1.5rem, 4vw, 2rem);"
                    >
                      {project.title}
                    </h3>
                    <p class="text-[var(--color-text-700)]">
                      {project.description}
                    </p>
                  </div>
                </div>
              </div>
            </div>
          ))
        }
      </div>

      <!-- Controles -->
      <button
        id="projects-prev"
        class="absolute top-1/2 left-2 transform -translate-y-1/2 bg-[var(--color-primary-500)] text-white p-2 rounded-full"
      >
        &#9664;
      </button>
      <button
        id="projects-next"
        class="absolute top-1/2 right-2 transform -translate-y-1/2 bg-[var(--color-primary-500)] text-white p-2 rounded-full"
      >
        &#9654;
      </button>

      <!-- Indicadores más abajo y más grandes -->
      <div
        id="projects-indicators"
        class="absolute bottom-8 left-1/2 transform -translate-x-1/2 flex space-x-2"
      >
      </div>
    </div>
  </div>
</section>

<style>
  #proyectos h2 {
    font-size: clamp(2rem, 5vw, 3rem);
  }
  #proyectos h3 {
    font-size: clamp(1.5rem, 4vw, 2rem);
  }
  #proyectos p {
    font-size: clamp(1rem, 2.5vw, 1.2rem);
    line-height: 1.6;
  }
</style>

<script type="module">
  const carousel = document.getElementById("projects-carousel");
  const slides = carousel.querySelectorAll(".slide");
  const total = slides.length;
  let current = 0;
  const nextBtn = document.getElementById("projects-next");
  const prevBtn = document.getElementById("projects-prev");
  const indicators = document.getElementById("projects-indicators");

  // Crear dots más grandes
  slides.forEach((_, idx) => {
    const dot = document.createElement("button");
    dot.className =
      "w-4 h-4 rounded-full bg-gray-300 transition-colors duration-300";
    dot.dataset.index = idx;
    dot.addEventListener("click", () => goTo(idx));
    indicators.appendChild(dot);
  });

  function update() {
    carousel.style.transform = `translateX(-${current * 100}%)`;
    indicators.querySelectorAll("button").forEach((btn, idx) => {
      if (idx === current) {
        btn.classList.replace("bg-gray-300", "bg-primary-500");
      } else {
        btn.classList.replace("bg-primary-500", "bg-gray-300");
      }
    });
  }

  function goTo(idx) {
    current = idx;
    update();
  }

  nextBtn.addEventListener("click", () => goTo((current + 1) % total));
  prevBtn.addEventListener("click", () => goTo((current - 1 + total) % total));

  update();
</script>
